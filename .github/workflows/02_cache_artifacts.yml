name: Runners demo

on:
  workflow_dispatch: # run this one manually from the Actions tab

permissions:
  contents: read

jobs:
  matrix-info:
    # Demonstrates "ubuntu-latest", "macos-latest", "windows-latest" labels
    strategy:
      matrix:
        os: [ubuntu-latest]
    runs-on: ${{ matrix.os }}

    steps:
      - name: Print basic runner info
        run: |
          echo "Runner OS: $RUNNER_OS"
          echo "Runner Temp: $RUNNER_TEMP"
          echo "Default shell varies by OS (bash on Linux/macOS, PowerShell on Windows)."

      - name: Show kernel / system details (Linux & macOS)
        if: runner.os != 'Windows'
        run: |
          uname -a
          sw_vers || true  # prints macOS version when available

      - name: Show system details (Windows)
        if: runner.os == 'Windows'
        run: |
          echo "System info:"
          systeminfo | findstr /B /C:"OS Name" /C:"OS Version"

      # Chapter 5: "Adding Additional Software on Runners" example (Linux)
      - name: Install an extra package on ubuntu-latest
        if: runner.os == 'Linux'
        run: |
          sudo apt-get update
          sudo apt-get install -y tree
          tree -L 1 .

      - name: Guidance to Included Software list (read the job log)
        run: |
          echo "In the job log, expand 'Set up job' → 'Runner Image' → 'Included Software' to see preinstalled tools."
          echo "SBOMs for runner images are available on the actions/runner-images releases page (as described in the book)."

  # IMMEDIATE DOWNSTREAM - No delays!
  immediate-post-runner-tasks:
    needs: matrix-info
    runs-on: ubuntu-latest
    if: always()  # Run always, just check outcome to decide action
    steps:
      - name: "⚡ Immediate post-completion handling (No queue delays!)"
        run: |
          echo "🚀 Runner workflow completed immediately - no delays!"
          echo "📊 Previous job status: ${{ needs.matrix-info.result }}"
          echo "⏰ Completion time: $(date '+%Y-%m-%d %H:%M:%S UTC')"
          
      - name: "🔗 Trigger downstream logic here instead of workflow_run"
        if: ${{ needs.matrix-info.result == 'success' }}
        run: |
          echo "✅ Runner demo successful - running success path actions"
          # Add your downstream success logic here
          
      - name: "🚨 Handle failure path - create issue issue immediately "  
        if: ${{ needs.matrix-info.result != 'success' }}
        uses: ./.github/workflows/create-failure-issue.yml
        with:
          title: "🚨 Runners demo failed on ${{ github.ref }}"
          body: |
            The Runners demo workflow failed. 
            🕐 Failed at: $(date)
            🏃 Job: matrix-info
            📌 Result: ${{ needs.matrix-info.result }}
            🔗 See run: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
        secrets: inherit